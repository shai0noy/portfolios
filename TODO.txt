### Pleae be carful not to override entire file when updating tasks ###

In details of gemel funds, handle gains display/calc - and cost basis!
DONE?: Show holdings of funds
דמי ניהול - לחשב בגמל וכו'
refactor code....
Consider if request deduping is needed in places (cuurently in yahoo, globes)
verify adj price of results from sheet and globes? is it adj or not? need to know for unrealized gains
Include mgmt fee in gemel calc
fetch mgmt fee from tase and also show
CPI data parsing, solve issue where values before 1985 are weird - 200x too large
Mobile viewing is all over the placed
Check crypto 1d change?...
Discovery/selling points splash page
tase types vs globes types??
If there is no sheet document ID, do not show the "create first portfolio" screen, rather, you should send the user to exisitng the screen to enter an existing sheet ID or create one
Make sure that div sheet rebuilding handles duplicates well.
Handle RSU style and Gemmel/Pension style div policy 
Support IRS/Gemmel/Pension sell/reassign model

ON HOLD: Handle splits, etc, name changes
ON HOLD: Support mobile screen sizes
ON HOLD: Use Finhub or marketstack over yahoo if possible or in addition (will reuqire to guide use rto create API key and add it to spreadsheet as part of setup)
When changing fields in "Add portfolio", it is very slow and laggy. Need a way to verify faster/with less laf (but on edit, not on focus loss)
Refine set of defaults columns shown
HOLD: Handle Reit taxing

Low priority:
- Smart layer based tax calc (FIFO selling and per layer taxing)
- ON HOLD: Add portfolio sum chart for dashboard view
- ON HOLD: Allow comparing portfolios to common indices, eg CPI, SP500, TLV-125
- ON HOLD: Use Gemini for anlysis and insight
- ON HOLD: Forcast mode, where future txns, vesting are taken into account, and growth of holding is predicted based on custom uesr input or recent trends. Should also include taxes

DONE: Dashbaord header - portfolio pct grow should take into account the the amount of stock and buy date etc
DONE: Dashbaord header - Add portfolio gain (value&pct) since date (1m,1y,3y,5y,all) taking into account revenue and add transactions since date
DONE: Comperasion chars + allow metrics: r^2, beta
DONE: Allow choosing between IL and US tbills and pass to alpha calc. Also add sharpe calc. Add toggle to choose in analysis window. Default IL.
DONE: Theres still chart-related code duplication between TickerDetails and other places like useChartComparison.ts
DONE?: The create first portfolio message should not appear when loggin failed. Instead should perform login.
DONE: In total holdings chart - holdings mode should be mutualy exclusive with comperission mode.
DONE: In total holdings chart - hide range options with insuffcient data
DONE: In total holdings chart - Fix gains pct chart and calc. Need to think exactly what base to use
DONE: maybe store type in sheet
DONE: Keep track of dividands since purchase! Add to sheet
DONE: If exposure porfile (e.g. 4D, 03) is avilable in ticker details, show two chips according to its parsing:
 - The numeric part is stock exposure 0-6 maps to (0%, <10%, <30%, <50%, <120%, <200%, >200%)
 - The letter part (which can be a 0) is foreign currency exposure 0,A-F maps to (0%, <10%, <30%, <50%, <120%, <200%, >200%)
 - parse this early and show in the ticker details UI
DONE: Show ticker type in dash
DONE: Allow fetching Israeli price indices (eg CPI) - https://api.cbs.gov.il/index/data/price?id=120010&format=json&download=false&PageSize=1000
DONE: toYahooSymbol method should prefix index tickers - but some symbols have none, so maybe we need to try both in parallel, same for currencies maybe? with =X suffix
DONE: securityId is populated with non numeric IDs - should be changed to number and only filled form globes/tase numeric IDs
DONE?: remove casts to any
DONE: move currency selector and "back to all" buttons in dashbaord 
DONE: Fix label of comission pct not to go into the text box
DONE: Cloudflare throttling and force cache
Done: add search to dashbaord - open ticker details rather than open add txn mode
Done: Div is broken again!
DONE: Make sure div calc in ticker details uses max data range and not just 1 y
DONE: In multi line charts - the tooltip should show just change, and have value for each line (with matching color)
DONE: In multi line charts - in range selection mode the selection shade should match the line color
DONE: use 5y rather than 1y for yahoo hist and improve name
DONE: Move SOURCE text in search result - smaller and in bottom corner
Done: Show sector and type in search results (currently showing type form code, need to reconcile..)
DONE: Show trading volume in TickerDetails
Done: REALLY need refactoring of typesDone: Display sector form gemel/pension
DONE?: Crypto not showing charts longer than 1y
Done:fix display name in search results (of IL tickers, seem to use ticke rather than name in dropdown)!
Done: In search resutls - also prefer matches of shorter name (when match is by name)
Done: in search results - sort e.g. stocks, funds, etfs, then bonds, etc - accroding to the popularity of instrument
- Done: daily movers by value/pct
- Done:  Add chart to ticker view - it should allow day range, week, month 1,3,5 years, YTD, max
- Done: Support switching display lang to Hebrew - should also affect stock names when avilable (with cookie to persist)
DONE: When showing http://localhost:5173/portfolios/ticker/TASE/123456 - Try to resolve ticker (e.g. LUMI) and update the URL and data (load merged data from tase, yahoo)
DONE: Fix TS2322: Type '{ ..., sheetId: string; }' is not assignable to type 'IntrinsicAttributes & TableProps'. Property 'sheetId' does not exist on type 'IntrinsicAttributes & TableProps' in Dashboard.tsx (removed sheetId prop from DashboardTable call).
DONE: Fix TS1484: 'TaseTicker' is a type and must be imported using a type-only import in ticker.ts.
DONE: Important: Improve google login handling - increase buffers, impl todos, make the session last long and require rarely re-login
DONE: Make ILS - agorot conversion much more robust, e.g. improve `const priceInILS = (h.exchange === 'TASE' && h.stockCurrency === 'ILS') ? h.currentPrice / 100 : h.currentPrice`
DONE: Complete priceUnit implementation - Update NewTransaction.tsx and TickerDetails.tsx to use priceUnit.
DONE: Remove unneeded empty lines in Dashboard.tsx
DONE: In ticker view, stock name is too small and should appear before the exchange name
DONE: Implement stateful URLs using react-router-dom to persist view/filters.
DONE: In ticker view, enhanced display of stock name, symbol, base price, data age, refresh button, and verified transaction prefill.
DONE: Addressed color contrast issues in light and dark modes (success/error colors, primary/text legibility).
DONE: Please configure caching and optimize code so that Yahoo fetches are minimized
DONE: Use google finance (in sheet??) instead of https://v6.exchangerate-api.com
DONE: Allow fetching TASE data by numeric ticker ID: e.g. from https://www.globes.co.il/data/webservices/financial.asmx/getInstrument?exchange=tase&symbol=1175819
DONE: Add "New transaction" to ticker viewer
DONE: Rename add trade to New transaction
DONE: Fix syntax error in DashboardTable.tsx (missing closing brace for TableProps interface)
DONE: Fix syntax error in TickerDetails.tsx (missing closing brace for TickerDetailsProps interface)
DONE: Fix ReferenceError: OpenInNewIcon is not defined in TickerDetails.tsx
DONE: Move Refresh Data button to the right side of the toggles and increase space between it to them.
DONE: Add robust error handling to data fetching functions in src/lib/sheets.ts to prevent dashboard loading issues.
DONE: The exchange selector switches when a stock is found - I want it to only be controlled by the user and stay in auto unless changed    
DONE: Make the display price for IL stocks PRICE agorot (storage currency remains ILS, and so does the total value)
DONE: When computing dashboard values, ignore txns with future dates. Show a small warning if any such exists.
DONE: Allow editing portfolios (not their ID!)
DONE: In portfolio headers in the dashboard - add a total value of the portfolio, day gain pct and day gain value, total gain unrealised
DONE: Add  code comments where they will be truly helpful - search through the code, don't be lazy
DONE: Add day change to dash rows and header
DONE: Make google account login last longer or auto renew!
DONE: Populate sectors
DONE: New Transaction UI - make comission field smaller, improve "ticker not found" location
DONE: Improve code comments where truly helpful
DONE: Portfolio list - should show a tax policy name not key
DONE: New portfolio UI - auto populate ID based on name - verify name chars are valid Uppercase a-z and - only
DONE: All yahoo calls shold use https://portfolios.noy-shai.workers.dev/?apiId=yahoo_hist&ticker=GOOG (replace GOOG, return val is the same) - without proxies
DONE: All currency code should be strongly typed, minimize code that uses string as currency in favor of an enum
DONE: Allow exporting CSV, sheet, holding sheet (flattaned)
DONE: Allow drag and drop CSV in wizard
DONE: Move currency selector to the line below to the right of the 1d/1w etc gain fields 
DONE: Add enum/type for exchanges inlcuding logic of parsing IDs from sheets.ts
DONE: show holding sum in his_held icon in addTxn view
DONE: open tickerDetails when clicking in addtxn view
DONE: In the dashboard rows, IL stock prices show price in NIS annotated with "ag." price should be shown in agorot too
DONE: In single ticker view mode, the base price is shown in NIS while the market proce is in agorot. Both should be in agorot
DONE: in the dashboard summary, all chahnges other than day chnage should have smaller font and be placed on a line below
DONE??: TODO: Fix GOOGLEFINANCE formula for Split_Adj_Open_Price to fetch historical price on the transaction date, not current price.
DONE: In add transaction - For tase sticks, the "total price" should be ILS,  but currently computed as agorot
DONE: Pass forceRefresh to getTickerData to bypass cache?
DONE:
    Add column to Trasnactions "Source" - fill it only for imports with "Import_yyyymmdd_hhmm" 
    Add column to txns "Orig_Open_Price_At_Date" set to open price of the stock at the date of txn - NOT using a goog finance formula, but rather the open price at the date a known at time of writing
    Add column to txns "Split_Adj_Open_Price" - this is using a goog finance formula
    Add column to txns "Split_Ratio" = Orig_Open_Price_At_Date / split_adj_open_price  -> using dynamic formula
    Add column to txns "Split_Adjusted_Price" = Price / Split_Ratio -> using dynamic formula
    Add column to txns "Split_Adjusted_Qty" = Price * Split_Ratio -> using dynamic formula
    Rename Trasnactions column Price to Original_Price
    Rename Trasnactions column Qty to Original_Qty
    All current logic that reads qty/price should use the adjusted ones. The orignal price/qty are only written to
DONE: Extract common code in gemel and pension
